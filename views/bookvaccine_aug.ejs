<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=`, initial-scale=1.0">
  <title>Book Vaccine</title>
  <style media="screen">
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    #container {
      background: rgb(233, 233, 233);
    }

    #center {
      background: rgb(255, 255, 255);
      width: 60%;
      height: 100vh;
      margin: 0 auto;
    }

    #content {
      width: 95%;
      margin: 0 auto;
    }

    .grid__container {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
      padding: 5px;
    }

    .grid__item {
      background-color: rgba(240, 240, 240, 0.8);
      border: 1px solid rgba(212, 212, 212, 0.8);
      padding: 10px;
      font-size: 0.9rem;
      text-align: center;
    }

    .day {
      text-align: center;
      font-size: 1rem;
    }

    .click {
      background-color: #fff;
      cursor: pointer;
    }

    .click:hover {
      /* background-color: rgb(248, 248, 248); */
      border: 1px solid black;
    }

    .empty {
      color: green;
    }

    .full {
      color: red;
    }

    h1 {
      padding-top: 40px;
      text-align: center;
    }

    a {
      color: gray;
    }

    a:hover {
      color: black;
    }

    /* The Modal (background) */
    .modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 1; /* Sit on top */
      padding-top: 100px; /* Location of the box */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: rgb(0,0,0); /* Fallback color */
      background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content */
    .modal-content {
      background-color: #fefefe;
      margin: auto;
      padding: 20px;
      border: 1px solid #888;
      width: 50%;
    }

    /* The Close Button */
    .close {
      color: #aaaaaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: #000;
      text-decoration: none;
      cursor: pointer;
    }

    /* The Modal (background) */
    .modalFull {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 1; /* Sit on top */
      padding-top: 100px; /* Location of the box */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: rgb(0,0,0); /* Fallback color */
      background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content */
    .modal-content {
      background-color: #fefefe;
      margin: auto;
      padding: 20px;
      border: 1px solid #888;
      width: 50%;
    }

    /* The CloseFull Button */
    .closeModalFull {
      color: #aaaaaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .closeModalFull:hover,
    .closeModalFull:focus {
      color: #000;
      text-decoration: none;
      cursor: pointer;
    }

    h1 {
      font-size: 1.6rem;
    }

    .input__container {
      width: 100%;
      /* padding: 10px; */
    }

    .input {
      width: 100%;
      border-top: none;
      border-left: none;
      border-right: none;
      border-bottom: 1px solid #000;
      padding: 10px;
      font-size: 18px;
    }

    .input::placeholder {
      opacity: .3;
    }

    .input:focus {
      outline: none;
      border-bottom: 2px solid #000;
    }

    .btn {
      width: 100%;
      text-align: right;
      margin: 10px 0;
    }

    .btn button {
      background-color: #00b686;
      padding: 5px 15px;
      border: none;
      font-size: 14px;
      margin-right: 10px;
    }

    .btn button:hover{
      cursor: pointer;
      background-color: #03c08e;
    }

    .btn button:focus {
      outline: none;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="center">
      <div id="content">
        <h1>รับสมัครพนักงานอาสาอำนวยความสะดวกผู้เข้ารับการฉีดวัคซีน ฯ</h1>
        <br>
        <a href="/">กรกฏาคม </a> | <a href="/aug"> สิงหาคม</a>
        <br>
        <br>
        <h2>สิงหาคม</h2>
        <div class="grid__container">
          <div class="day">อา</div>
          <div class="day">จ</div>
          <div class="day">อ</div>
          <div class="day">พ</div>
          <div class="day">พฤ</div>
          <div class="day">ศ</div>
          <div class="day">ส</div>
          <div class="grid__item">1</div>
          <div class="grid__item click" id="2021-08-02" onclick="selectDate(this)">
            2
            <br>
            <% 
              const find_date2 = data.find(item => {
                const d = new Date(item._id)
                return 2 == d.getDate()
              })
              if (find_date2) {
                const rs2 = 6 - find_date2.count
                if (rs2 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs2} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item click" id="2021-08-03" onclick="selectDate(this)">
            3
            <br>
            <% 
              const find_date3 = data.find(item => {
                const d = new Date(item._id)
                return 3 == d.getDate()
              })
              if (find_date3) {
                const rs3 = 6 - find_date3.count
                if (rs3 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs3} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item click" id="2021-08-04" onclick="selectDate(this)">
            4
            <br>
            <% 
              const find_date4 = data.find(item => {
                const d = new Date(item._id)
                return 4 == d.getDate()
              })
              if (find_date4) {
                const rs4 = 6 - find_date4.count
                if (rs4 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs4} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item click" id="2021-08-05" onclick="selectDate(this)">
            5
            <br>
            <% 
              const find_date5 = data.find(item => {
                const d = new Date(item._id)
                return 5 == d.getDate()
              })
              if (find_date5) {
                const rs5 = 6 - find_date5.count
                if (rs5 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs5} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item click" id="2021-08-06" onclick="selectDate(this)">
            6
            <br>
            <% 
              const find_date6 = data.find(item => {
                const d = new Date(item._id)
                return 6 == d.getDate()
              })
              if (find_date6) {
                const rs6 = 6 - find_date6.count
                if (rs6 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs6} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item">7</div>
          <div class="grid__item">8</div>
          <div class="grid__item click" id="2021-08-09" onclick="selectDate(this)">
            9
            <br>
            <% 
              const find_date9 = data.find(item => {
                const d = new Date(item._id)
                return 9 == d.getDate()
              })
              if (find_date9) {
                const rs9 = 6 - find_date9.count
                if (rs9 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs9} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item click" id="2021-08-10" onclick="selectDate(this)">
            10
            <br>
            <% 
              const find_date10 = data.find(item => {
                const d = new Date(item._id)
                return 10 == d.getDate()
              })
              if (find_date10) {
                const rs10 = 6 - find_date10.count
                if (rs10 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs10} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item click" id="2021-08-11" onclick="selectDate(this)">
            11
            <br>
            <% 
              const find_date11 = data.find(item => {
                const d = new Date(item._id)
                return 11 == d.getDate()
              })
              if (find_date11) {
                const rs11 = 6 - find_date11.count
                if (rs11 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs11} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item">12</div>
          <div class="grid__item click" id="2021-08-13" onclick="selectDate(this)">
            13
            <br>
            <% 
              const find_date13 = data.find(item => {
                const d = new Date(item._id)
                return 13 == d.getDate()
              })
              if (find_date13) {
                const rs13 = 6 - find_date13.count
                if (rs13 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs13} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item">14</div>
          <div class="grid__item">15</div>
          <div class="grid__item click" id="2021-08-16" onclick="selectDate(this)">
            16
            <br>
            <% 
              const find_date16 = data.find(item => {
                const d = new Date(item._id)
                return 16 == d.getDate()
              })
              if (find_date16) {
                const rs16 = 6 - find_date16.count
                if (rs16 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs16} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item click" id="2021-08-17" onclick="selectDate(this)">
            17
            <br>
            <% 
              const find_date17 = data.find(item => {
                const d = new Date(item._id)
                return 17 == d.getDate()
              })
              if (find_date17) {
                const rs17 = 6 - find_date17.count
                if (rs17 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs17} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item click" id="2021-08-18" onclick="selectDate(this)">
            18
            <br>
            <% 
              const find_date18 = data.find(item => {
                const d = new Date(item._id)
                return 18 == d.getDate()
              })
              if (find_date18) {
                const rs18 = 6 - find_date18.count
                if (rs18 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs18} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item click" id="2021-08-19" onclick="selectDate(this)">
            19
            <br>
            <% 
              const find_date19 = data.find(item => {
                const d = new Date(item._id)
                return 19 == d.getDate()
              })
              if (find_date19) {
                const rs19 = 6 - find_date19.count
                if (rs19 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs19} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item click" id="2021-08-20" onclick="selectDate(this)">
            20
            <br>
            <% 
              const find_date20 = data.find(item => {
                const d = new Date(item._id)
                return 20 == d.getDate()
              })
              if (find_date20) {
                const rs20 = 6 - find_date20.count
                if (rs20 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs20} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item">21</div>
          <div class="grid__item">22</div>
          <div class="grid__item click" id="2021-08-23" onclick="selectDate(this)">
            23
            <br>
            <% 
              const find_date23 = data.find(item => {
                const d = new Date(item._id)
                return 23 == d.getDate()
              })
              if (find_date23) {
                const rs23 = 6 - find_date23.count
                if (rs23 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs23} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item click" id="2021-08-24" onclick="selectDate(this)">
            24
            <br>
            <% 
              const find_date24 = data.find(item => {
                const d = new Date(item._id)
                return 24 == d.getDate()
              })
              if (find_date24) {
                const rs24 = 6 - find_date24.count
                if (rs24 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs24} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item click" id="2021-08-25" onclick="selectDate(this)">
            25
            <br>
            <% 
              const find_date25 = data.find(item => {
                const d = new Date(item._id)
                return 25 == d.getDate()
              })
              if (find_date25) {
                const rs25 = 6 - find_date25.count
                if (rs25 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs25} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item click" id="2021-08-26" onclick="selectDate(this)">
            26
            <br>
            <% 
              const find_date26 = data.find(item => {
                const d = new Date(item._id)
                return 26 == d.getDate()
              })
              if (find_date26) {
                const rs26 = 6 - find_date26.count
                if (rs26 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs26} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item click" id="2021-08-27" onclick="selectDate(this)">
            27
            <br>
            <% 
              const find_date27 = data.find(item => {
                const d = new Date(item._id)
                return 27 == d.getDate()
              })
              if (find_date27) {
                const rs27 = 6 - find_date27.count
                if (rs27 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs27} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item">28</div>
          <div class="grid__item">29</div>
          <div class="grid__item click" id="2021-08-30" onclick="selectDate(this)">
            30
            <br>
            <% 
              const find_date30 = data.find(item => {
                const d = new Date(item._id)
                return 30 == d.getDate()
              })
              if (find_date30) {
                const rs30 = 6 - find_date30.count
                if (rs30 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs30} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item click" id="2021-08-31" onclick="selectDate(this)">
            31
            <br>
            <% 
              const find_date31 = data.find(item => {
                const d = new Date(item._id)
                return 31 == d.getDate()
              })
              if (find_date31) {
                const rs31 = 6 - find_date31.count
                if (rs31 != 0) {
            %>
                  <span class="empty"><%= `ว่าง ${rs31} คน` %></span>
            <%
                } else {
            %>
                  <span class="full"><%= 'เต็ม' %></span>
            <%
                }
              } else {
            %>
              <span class="empty"><%= 'ว่าง 6 คน' %></span>
            <% } %>
          </div>
          <div class="grid__item">1</div>
          <div class="grid__item">2</div>
          <div class="grid__item">3</div>
          <div class="grid__item">4</div>

        </div>
      </div>
    </div>
  </div>

  <!-- The Modal Full -->
  <div id="myModalFull" class="modal">

    <div class="modal-content">
      <span class="closeModalFull">&times;</span>
      <h3 style="text-align: center; color: red;">วันที่เลือกเต็มแล้ว</h3>
    </div>

  </div>

  <!-- The Modal -->
  <div id="myModal" class="modal">

    <div class="modal-content">
      <span class="close">&times;</span>
      <form action="#">
        <label>รหัสพนักงาน</label>
        <div class="input__container">
          <input type="text" name="employee_id" id="employee_id" class="input" autocomplete="off" placeholder="218xxxx">
        </div>
        <br>
        <label>คำนำหน้า</label>
        <div class="input__container">
          <input type="text" name="prefix" id="prefix" class="input" autocomplete="off" placeholder="นาย/นาง/นางสาว">
        </div>
        <br>
        <label>ชื่อ</label>
        <div class="input__container">
          <input type="text" name="firstname" id="firstname" class="input" autocomplete="off" placeholder="สมมติ">
        </div>
        <br>
        <label>นามสกุล</label>
        <div class="input__container">
          <input type="text" name="lastname" id="lastname" class="input" autocomplete="off" placeholder="สมมติ">
        </div>
        <br>

        <label>สังกัดหน่วยงาน</label>
        <div class="input__container">
          <input type="text" name="institution" id="institution" class="input" autocomplete="off" placeholder="ฝสส">
        </div>
        <br>

        <label>เบอร์โทร</label>
        <div class="input__container">
          <input type="number" name="tel" id="tel" class="input" autocomplete="off" placeholder="096745xxxx">
        </div>
        <br>

        <label>วันที่อาสา</label>
        <div class="input__container">
          <input type="text" name="date_time" id="date_time" class="input" readonly style="background-color: rgb(204, 204, 204);">
        </div>
        <br>

        <div class="btn">
          <button type="submit" id="bookvaccine">บันทึก</button>
        </div>
        
      </form>
    </div>

  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js" crossorigin="anonymous"></script>
  <script type="text/javascript">
    const bookvaccine = document.getElementById('bookvaccine').addEventListener('click', bookVaccineFn)
    const modal = document.getElementById("myModal");
    const closeModal = document.getElementsByClassName("close")[0].addEventListener("click", closeModalFn)

    const modalFull = document.getElementById("myModalFull");
    const closeModalFull = document.getElementsByClassName("closeModalFull")[0].addEventListener("click", closeModalFullFn)

    let date_time = document.getElementById('date_time')
    
    function selectDate(e) {
      console.log(e.children[1].className)
      if (e.children[1].className == 'full') {
        console.log('if')
        modalFull.style.display = "block"
      } else {
        console.log('else')
        console.log(e.id)
        date_time.value = e.id
        modal.style.display = "block";
      }
    }

    function closeModalFn() {
      modal.style.display = "none";
    }

    function closeModalFullFn() {
      modalFull.style.display = "none";
    }

    function bookVaccineFn(e) {
      e.preventDefault()
      const prefix = document.getElementById('prefix').value
      const employee_id = document.getElementById('employee_id').value
      const firstname = document.getElementById('firstname').value
      const lastname = document.getElementById('lastname').value
      const institution = document.getElementById('institution').value
      const tel = document.getElementById('tel').value

      const obj = {
        prefix,
        employee_id,
        firstname,
        lastname,
        institution,
        tel,
        date_time: date_time.value
      }

      console.log('obj -> ', obj)

      axios.post('/api/v1/bookvaccine', obj)
      .then(function (response) {
        console.log(response);
        window.location = "/aug";
      })
      .catch(function (error) {
        console.log(error);
      });
      modal.style.display = "none";
    }
  </script>
</body>

</html>